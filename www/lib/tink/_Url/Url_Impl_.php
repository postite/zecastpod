<?php
/**
 * Generated by Haxe 4.0.0 (git build development @ 3018ab1)
 */

namespace tink\_Url;

use \tink\json\_Representation\Representation_Impl_;
use \php\_Boot\HxClosure;
use \php\Boot;
use \tink\url\_Path\Path_Impl_;
use \tink\url\_Host\Host_Impl_;
use \php\_Boot\HxString;
use \php\_Boot\HxAnon;

final class Url_Impl_ {
	/**
	 * @var int
	 */
	const AUTH = 6;
	/**
	 * @var int
	 */
	const HASH = 12;
	/**
	 * @var int
	 */
	const HOSTNAMES = 7;
	/**
	 * @var int
	 */
	const PATH = 8;
	/**
	 * @var int
	 */
	const PAYLOAD = 3;
	/**
	 * @var int
	 */
	const QUERY = 10;
	/**
	 * @var int
	 */
	const SCHEME = 2;




	/**
	 * @param object $parts
	 * 
	 * @return object
	 */
	static public function _new ($parts) {
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:22: character 10
		return $parts;
	}


	/**
	 * @param string $v
	 * 
	 * @return object
	 */
	static public function fromRepresentation ($v) {
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:166: characters 5-30
		return Url_Impl_::parse(Representation_Impl_::get($v));
	}


	/**
	 * @param string $s
	 * 
	 * @return object
	 */
	static public function fromString ($s) {
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:86: characters 51-66
		return Url_Impl_::parse($s);
	}


	/**
	 * @param object $this
	 * 
	 * @return string
	 */
	static public function get_pathWithQuery ($this1) {
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:20: characters 14-80
		if ($this1->query === null) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:20: characters 37-46
			return $this1->path;
		} else {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:20: characters 52-80
			return ($this1->path??'null') . "?" . ($this1->query??'null');
		}
	}


	/**
	 * @param object $parts
	 * 
	 * @return object
	 */
	static public function make ($parts) {
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:150: lines 150-159
		$parts1 = new HxAnon([
			"payload" => "",
			"path" => $parts->path,
			"query" => $parts->query,
			"host" => $parts->host,
			"hosts" => $parts->hosts,
			"auth" => $parts->auth,
			"scheme" => $parts->scheme,
			"hash" => $parts->hash,
		]);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:160: characters 5-23
		Url_Impl_::makePayload($parts1);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:161: characters 12-26
		return $parts1;
	}


	/**
	 * @param object $parts
	 * 
	 * @return void
	 */
	static public function makePayload ($parts) {
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:53: characters 5-22
		$payload = "";
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:55: lines 55-63
		if ($parts->auth === null) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:56: lines 56-58
			if ($parts->host !== null) {
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:58: characters 9-29
				$payload = "" . (("//" . ($parts->host??'null'))??'null');
			}
		} else if ($parts->host === null) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:59: characters 20-24
			$auth = $parts->auth;
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:60: characters 9-29
			$payload = "" . (("//" . ((($auth === null ? "" : "" . ($auth??'null') . "@"))??'null'))??'null');
		} else {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:61: characters 20-24
			$auth1 = $parts->auth;
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:62: characters 9-34
			$payload = "" . (("//" . ((($auth1 === null ? "" : "" . ($auth1??'null') . "@"))??'null') . ($parts->host??'null'))??'null');
		}
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:65: characters 5-26
		$payload = ($payload??'null') . ($parts->path??'null');
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:67: characters 12-23
		$_g = $parts->query;
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:68: lines 68-69
		if ($_g !== null) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:69: characters 15-31
			$payload = ($payload??'null') . (("?" . ($_g??'null'))??'null');
		}

		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:72: characters 12-22
		$_g1 = $parts->hash;
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:73: lines 73-74
		if ($_g1 !== null) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:74: characters 15-31
			$payload = ($payload??'null') . (("#" . ($_g1??'null'))??'null');
		}

		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:77: characters 21-55
		$parts->payload = $payload;
	}


	/**
	 * @param string $_
	 * 
	 * @return void
	 */
	static public function noop ($_) {
	}


	/**
	 * @param string $s
	 * @param \Closure $onError
	 * 
	 * @return object
	 */
	static public function parse ($s, $onError = null) {
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:90: lines 90-91
		if ($s === null) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:91: characters 7-23
			return Url_Impl_::parse("");
		}
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:93: lines 93-94
		if ($onError === null) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:94: characters 7-21
			$onError = new HxClosure(Url_Impl_::class, 'noop');
		}
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:96: characters 5-17
		$s = trim($s);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:98: lines 98-99
		if (\StringTools::startsWith($s, "data:")) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:99: characters 14-65
			return new HxAnon([
				"scheme" => "data",
				"payload" => HxString::substr($s, 5),
			]);
		}
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:101: characters 5-114
		$FORMAT = new \EReg("^(([a-zA-Z][a-zA-Z0-9\\-+.]*):)?((//(([^@/]+)@)?([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?)\$", "");
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:102: characters 5-48
		$HOST = new \EReg("^(\\[(.*)\\]|([^:]*))(:(.*))?\$", "");
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:105: characters 5-20
		$FORMAT->match($s);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:107: lines 107-131
		$hosts = null;
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:107: characters 24-49
		$_g = $FORMAT->matched(7);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:108: lines 108-130
		if ($_g === null) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:107: lines 107-131
			$hosts = new \Array_hx();
		} else {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:110: lines 110-130
			$_g1 = new \Array_hx();
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:110: lines 110-130
			$_g11 = 0;
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:110: lines 110-130
			$_g2 = \Array_hx::wrap(explode(",", $_g));
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:110: lines 110-130
			while ($_g11 < $_g2->length) {
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:110: characters 18-22
				$host = ($_g2->arr[$_g11] ?? null);
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:110: lines 110-130
				$_g11 = $_g11 + 1;
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:111: characters 15-31
				$HOST->match($host);
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:112: lines 112-118
				$host1 = null;
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:112: characters 51-66
				$_g3 = $HOST->matched(2);
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:112: characters 34-49
				$_g4 = $HOST->matched(3);
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:113: lines 113-117
				if ($_g3 === null) {
					#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:112: lines 112-118
					$host1 = $_g4;
				} else if ($_g4 === null) {
					#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:112: lines 112-118
					$host1 = "[" . ($_g3??'null') . "]";
				} else {
					#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:116: characters 21-50
					$onError("invalid host " . ($host??'null'));
					#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:112: lines 112-118
					$host1 = null;
				}
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:119: lines 119-128
				$port = null;
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:119: characters 33-48
				$_g5 = $HOST->matched(5);
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:120: lines 120-127
				if ($_g5 === null) {
					#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:119: lines 119-128
					$port = null;
				} else {
					#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:122: characters 30-45
					$_g51 = \Std::parseInt($_g5);
					#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:123: lines 123-126
					if ($_g51 === null) {
						#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:124: characters 29-55
						$onError("invalid port " . ($_g5??'null'));
						#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:119: lines 119-128
						$port = null;
					} else {
						#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:119: lines 119-128
						$port = $_g51;
					}
				}
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:129: characters 15-35
				$x = Host_Impl_::_new($host1, $port);
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:129: characters 15-35
				$_g1->arr[$_g1->length] = $x;
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:129: characters 15-35
				++$_g1->length;

			}

			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:107: lines 107-131
			$hosts = $_g1;
		}
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:132: characters 5-37
		$path = $FORMAT->matched(8);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:134: lines 134-135
		if (($hosts->length > 0) && (((0 >= strlen($path) ? "" : $path[0])) !== "/")) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:135: characters 7-22
			$path = "/" . ($path??'null');
		}
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:138: characters 15-37
		$parts = $FORMAT->matched(2);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:139: characters 16-39
		$parts1 = $FORMAT->matched(3);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:140: characters 13-21
		$hosts1 = ($hosts->arr[0] ?? null);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:142: characters 13-38
		$parts2 = $FORMAT->matched(6);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:137: lines 137-146
		$parts3 = Path_Impl_::ofString($path);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:144: characters 14-35
		$parts4 = $FORMAT->matched(10);
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:137: lines 137-146
		return new HxAnon([
			"scheme" => $parts,
			"payload" => $parts1,
			"host" => $hosts1,
			"hosts" => $hosts,
			"auth" => $parts2,
			"path" => $parts3,
			"query" => $parts4,
			"hash" => $FORMAT->matched(12),
		]);
	}


	/**
	 * @param object $this
	 * @param object $that
	 * 
	 * @return object
	 */
	static public function resolve ($this1, $that) {
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:27: lines 27-49
		if ($that->scheme !== null) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:27: characters 32-36
			return $that;
		} else if ($that->host !== null) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:29: lines 29-34
			if ($that->scheme !== null) {
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:29: characters 34-38
				return $that;
			} else {
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:31: characters 11-41
				$copy = \Reflect::copy($that);
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:32: characters 27-52
				$copy->scheme = $this1->scheme;
				#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:33: characters 11-22
				return $copy;
			}
		} else {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:37: characters 17-42
			$parts = Path_Impl_::join($this1->path, $that->path);
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:36: lines 36-44
			$parts1 = new HxAnon([
				"path" => $parts,
				"payload" => "",
				"scheme" => $this1->scheme,
				"query" => $that->query,
				"auth" => $this1->auth,
				"host" => $this1->host,
				"hash" => $that->hash,
			]);
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:46: characters 9-27
			Url_Impl_::makePayload($parts1);
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:48: characters 16-30
			return $parts1;
		}
	}


	/**
	 * @param object $this
	 * 
	 * @return string
	 */
	static public function toRepresentation ($this1) {
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:168: characters 12-52
		return Url_Impl_::toString($this1);
	}


	/**
	 * @param object $this
	 * 
	 * @return string
	 */
	static public function toString ($this1) {
		#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:82: lines 82-83
		if ($this1->scheme === null) {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:82: characters 18-30
			return $this1->payload;
		} else {
			#/Users/ut/haxe/haxe_libraries/tink_url/0.4.1/haxelib/src/tink/Url.hx:83: characters 17-46
			return "" . ($this1->scheme??'null') . ":" . ($this1->payload??'null');
		}
	}
}


Boot::registerClass(Url_Impl_::class, 'tink._Url.Url_Impl_');
Boot::registerGetters('tink\\_Url\\Url_Impl_', [
	'pathWithQuery' => true
]);
