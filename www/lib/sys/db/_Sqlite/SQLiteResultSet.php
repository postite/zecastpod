<?php
/**
 * Generated by Haxe 4.0.0 (git build development @ 3018ab1)
 */

namespace sys\db\_Sqlite;

use \php\Boot;
use \haxe\ds\List_hx;
use \sys\db\ResultSet;
use \php\_Boot\HxAnon;

class SQLiteResultSet implements ResultSet {
	/**
	 * @var int
	 */
	public $_length;
	/**
	 * @var int
	 */
	public $_nfields;
	/**
	 * @var int
	 */
	public $currentIndex;
	/**
	 * @var mixed
	 */
	public $fieldsInfo;
	/**
	 * @var bool
	 */
	public $loaded;
	/**
	 * @var \SQLite3Result
	 */
	public $result;
	/**
	 * @var mixed
	 */
	public $rows;


	/**
	 * @param \SQLite3Result $result
	 * 
	 * @return void
	 */
	public function __construct ($result) {
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:99: characters 25-26
		$this->currentIndex = 0;
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:98: characters 20-25
		$this->loaded = false;
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:96: characters 23-24
		$this->_nfields = 0;
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:95: characters 22-23
		$this->_length = 0;
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:106: characters 3-23
		$this->result = $result;
	}


	/**
	 * @param mixed $row
	 * 
	 * @return mixed
	 */
	public function correctArrayTypes ($row) {
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:146: lines 146-152
		$_gthis = $this;
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:147: characters 20-35
		if ($this->fieldsInfo === null) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:147: characters 20-35
			$this->fieldsInfo = [];
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:147: characters 20-35
			$_g1 = 0;
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:147: characters 20-35
			$_g = $this->get_nfields();
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:147: characters 20-35
			while ($_g1 < $_g) {
				#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:147: characters 20-35
				$_g1 = $_g1 + 1;
				#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:147: characters 20-35
				$i = $_g1 - 1;
				#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:147: characters 20-35
				$this->fieldsInfo[$this->result->columnName($i)] = $this->result->columnType($i);
			}

		}
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:147: characters 3-36
		$fieldsInfo = $this->fieldsInfo;
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:148: lines 148-150
		foreach ($row as $field => $value) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:149: characters 4-54
			$val = $_gthis->correctType($value, $fieldsInfo[$field]);
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:149: characters 4-54
			$row[$field] = $val;
		};
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:151: characters 3-18
		return $row;
	}


	/**
	 * @param string $value
	 * @param int $type
	 * 
	 * @return mixed
	 */
	public function correctType ($value, $type) {
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:172: characters 3-33
		if ($value === null) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:172: characters 22-33
			return null;
		}
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:173: characters 3-62
		if ($type === SQLITE3_INTEGER) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:173: characters 38-62
			return (int)($value);
		}
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:174: characters 3-62
		if ($type === SQLITE3_FLOAT) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:174: characters 36-62
			return (float)($value);
		}
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:175: characters 3-15
		return $value;
	}


	/**
	 * @return void
	 */
	public function fetchAll () {
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:179: characters 3-28
		$this->rows = [];
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:180: characters 3-17
		$index = 0;
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:181: characters 3-52
		$row = $this->result->fetchArray(SQLITE3_ASSOC);
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:182: lines 182-186
		while ($row !== false) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:183: characters 4-40
			$this->rows[$index] = $this->correctArrayTypes($row);
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:184: characters 4-48
			$row = $this->result->fetchArray(SQLITE3_ASSOC);
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:185: characters 4-11
			$index = $index + 1;
		}
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:187: characters 3-18
		$this->_length = $index;
	}


	/**
	 * @param int $n
	 * 
	 * @return int
	 */
	public function getIntResult ($n) {
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:134: characters 10-34
		return (int)($this->getResult($n));
	}


	/**
	 * @param int $n
	 * 
	 * @return string
	 */
	public function getResult ($n) {
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:128: characters 3-22
		if (!$this->loaded) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:128: characters 16-22
			$this->load();
		}
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:129: characters 3-30
		if (!$this->hasNext()) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:129: characters 19-30
			return null;
		}
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:130: characters 10-52
		return array_values($this->rows[$this->currentIndex])[$n];
	}


	/**
	 * @return int
	 */
	public function get_nfields () {
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:191: characters 25-40
		return $this->_nfields;
	}


	/**
	 * @return bool
	 */
	public function hasNext () {
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:110: characters 3-22
		if (!$this->loaded) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:110: characters 16-22
			$this->load();
		}
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:111: characters 3-32
		return $this->currentIndex < $this->_length;
	}


	/**
	 * @return void
	 */
	public function load () {
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:165: characters 3-16
		$this->loaded = true;
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:166: characters 3-33
		$this->_nfields = $this->result->numColumns();
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:167: characters 3-18
		if ($this->fieldsInfo === null) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:167: characters 3-18
			$this->fieldsInfo = [];
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:167: characters 3-18
			$_g1 = 0;
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:167: characters 3-18
			$_g = $this->get_nfields();
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:167: characters 3-18
			while ($_g1 < $_g) {
				#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:167: characters 3-18
				$_g1 = $_g1 + 1;
				#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:167: characters 3-18
				$i = $_g1 - 1;
				#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:167: characters 3-18
				$this->fieldsInfo[$this->result->columnName($i)] = $this->result->columnType($i);
			}

		}
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:168: characters 3-13
		$this->fetchAll();
	}


	/**
	 * @return mixed
	 */
	public function next () {
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:115: characters 3-22
		if (!$this->loaded) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:115: characters 16-22
			$this->load();
		}
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:117: characters 10-50
		return new HxAnon($this->correctArrayTypes($this->rows[$this->currentIndex++]));
	}


	/**
	 * @return List_hx
	 */
	public function results () {
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:120: lines 120-125
		$_gthis = $this;
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:121: characters 3-22
		if (!$this->loaded) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:121: characters 16-22
			$this->load();
		}
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:122: characters 3-25
		$list = new List_hx();
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:123: characters 3-91
		foreach (($this->rows) as $_ => $row) {
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:123: characters 50-89
			$tmp = new HxAnon($_gthis->correctArrayTypes($row));
			#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:123: characters 41-90
			$list->add($tmp);
		};
		#/Users/ut/haxe/versions/4.0.0-preview.3/std/php/_std/sys/db/Sqlite.hx:124: characters 3-14
		return $list;
	}
}


Boot::registerClass(SQLiteResultSet::class, 'sys.db._Sqlite.SQLiteResultSet');
